import{G as Q,aN as W,J as X,a0 as N,B as Y,ah as Z,k as h,C as ee,A as te,r as d,o as m,l as y,w as o,f as a,h as n,u as r,i as E,t as p,j as B,e as S,y as ae,m as se,F as oe}from"./vendor.d12b5734.js";import{j as re,u as le,w as V,x as ne}from"./main.465728e1.js";import{u as ie}from"./estimate.f77ffc39.js";import{u as de}from"./global.dc565c4e.js";import"./auth.c88ceb4c.js";const me={class:"mr-3 text-sm"},ce={class:"mr-3 text-sm"},ue={class:"fixed top-0 left-0 hidden h-full pt-16 pb-4 bg-white w-88 xl:block"},_e={class:"flex items-center justify-between px-4 pt-8 pb-6 border border-gray-200 border-solid"},pe={class:"flex ml-3",role:"group","aria-label":"First group"},fe={class:"px-4 py-1 pb-2 mb-2 text-sm border-b border-gray-200 border-solid"},ye={class:"px-2"},ge={class:"px-2"},be={class:"px-2"},he={class:"h-full pb-32 overflow-y-scroll border-l border-gray-200 border-solid sw-scroll"},Be={class:"flex-2"},ve={class:"mb-1 text-md not-italic font-medium leading-5 text-gray-500 capitalize"},xe={class:"flex-1 whitespace-nowrap right"},we={class:"text-sm text-right text-gray-500 non-italic"},ke={key:0,class:"flex justify-center px-4 mt-5 text-sm text-gray-600"},Ee={class:"flex flex-col min-h-0 mt-8 overflow-hidden",style:{height:"75vh"}},Se=["src"],De={setup(Ve){const c=Q(),F=W(),i=ie(),f=de(),j=re(),{tm:I,t:u}=X();let v=N({}),t=N({orderBy:"",orderByField:"",estimate_number:""}),x=Y(!1);Z("utils"),le();const R=h(()=>i.selectedViewEstimate),$=h(()=>t.orderBy==="asc"||t.orderBy==null);h(()=>$.value?I("general.ascending"):I("general.descending"));const C=h(()=>v.unique_hash?`/estimates/pdf/${v.unique_hash}`:!1);ee(c,()=>{D()}),z(),D(),_=te.exports.debounce(_,500);function T(e){return c.params.id==e}async function z(){await i.fetchEstimate({limit:"all"},f.companySlug),setTimeout(()=>{A()},500)}async function D(){if(c&&c.params.id){let e=await i.fetchViewEstimate({id:c.params.id},f.companySlug);e.data&&Object.assign(v,e.data.data)}}function A(){const e=document.getElementById(`estimate-${c.params.id}`);e&&(e.scrollIntoView({behavior:"smooth"}),e.classList.add("shake"))}async function _(){let e={};t.estimate_number!==""&&t.estimate_number!==null&&t.estimate_number!==void 0&&(e.estimate_number=t.estimate_number),t.orderBy!==null&&t.orderBy!==void 0&&(e.orderBy=t.orderBy),t.orderByField!==null&&t.orderByField!==void 0&&(e.orderByField=t.orderByField),x.value=!0;try{let l=await i.searchEstimate(e,f.companySlug);x.value=!1,l.data.data&&(i.estimates=l.data.data)}catch{x.value=!1}}function L(){return t.orderBy==="asc"?(t.orderBy="desc",_(),!0):(t.orderBy="asc",_(),!0)}async function P(){j.openDialog({title:u("general.are_you_sure"),message:u("estimates.confirm_mark_as_accepted",1),yesLabel:u("general.ok"),noLabel:u("general.cancel"),variant:"primary",size:"lg",hideNoButton:!1}).then(async e=>{let l={slug:f.companySlug,id:c.params.id,status:"ACCEPTED"};e&&(i.acceptEstimate(l),F.push({name:"estimates.dashboard"}))})}async function U(){j.openDialog({title:u("general.are_you_sure"),message:u("estimates.confirm_mark_as_rejected",1),yesLabel:u("general.ok"),noLabel:u("general.cancel"),variant:"primary",size:"lg",hideNoButton:!1}).then(async e=>{let l={slug:f.companySlug,id:c.params.id,status:"REJECTED"};e&&(i.rejectEstimate(l),F.push({name:"estimates.dashboard"}))})}return(e,l)=>{const g=d("BaseButton"),G=d("BasePageHeader"),b=d("BaseIcon"),q=d("BaseInput"),w=d("BaseRadio"),k=d("BaseInputGroup"),H=d("BaseEstimateStatusBadge"),J=d("BaseFormatMoney"),M=d("router-link"),O=d("BasePage");return m(),y(O,{class:"xl:pl-96"},{default:o(()=>[a(G,{title:r(R).estimate_number},{actions:o(()=>[n("div",me,[r(i).selectedViewEstimate.status==="DRAFT"?(m(),y(g,{key:0,variant:"primary",onClick:P},{default:o(()=>[E(p(e.$t("estimates.accept_estimate")),1)]),_:1})):B("",!0)]),n("div",ce,[r(i).selectedViewEstimate.status==="DRAFT"?(m(),y(g,{key:0,variant:"primary-outline",onClick:U},{default:o(()=>[E(p(e.$t("estimates.reject_estimate")),1)]),_:1})):B("",!0)])]),_:1},8,["title"]),n("div",ue,[n("div",_e,[a(q,{modelValue:r(t).estimate_number,"onUpdate:modelValue":l[0]||(l[0]=s=>r(t).estimate_number=s),placeholder:e.$t("general.search"),type:"text",variant:"gray",onInput:_},{right:o(()=>[a(b,{name:"SearchIcon",class:"h-5 text-gray-400"})]),_:1},8,["modelValue","placeholder"]),n("div",pe,[a(ne,{position:"bottom-start","width-class":"w-50","position-class":"left-0"},{activator:o(()=>[a(g,{variant:"gray"},{default:o(()=>[a(b,{name:"FilterIcon",class:"h-5"})]),_:1})]),default:o(()=>[n("div",fe,p(e.$t("general.sort_by")),1),n("div",ye,[a(V,{class:"rounded-md pt-3 hover:rounded-md"},{default:o(()=>[a(k,{class:"-mt-3 font-normal"},{default:o(()=>[a(w,{id:"filter_estimate_date",modelValue:r(t).orderByField,"onUpdate:modelValue":l[1]||(l[1]=s=>r(t).orderByField=s),label:e.$t("reports.estimates.estimate_date"),size:"sm",name:"filter",value:"estimate_date",onChange:_},null,8,["modelValue","label"])]),_:1})]),_:1})]),n("div",ge,[a(V,{class:"rounded-md pt-3 hover:rounded-md"},{default:o(()=>[a(k,{class:"-mt-3 font-normal"},{default:o(()=>[a(w,{id:"filter_due_date",modelValue:r(t).orderByField,"onUpdate:modelValue":[l[2]||(l[2]=s=>r(t).orderByField=s),_],label:e.$t("estimates.due_date"),value:"expiry_date",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})]),n("div",be,[a(V,{class:"rounded-md pt-3 hover:rounded-md"},{default:o(()=>[a(k,{class:"-mt-3 font-normal"},{default:o(()=>[a(w,{id:"filter_estimate_number",modelValue:r(t).orderByField,"onUpdate:modelValue":[l[3]||(l[3]=s=>r(t).orderByField=s),_],label:e.$t("estimates.estimate_number"),value:"estimate_number",size:"sm",name:"filter"},null,8,["modelValue","label"])]),_:1})]),_:1})])]),_:1}),a(g,{class:"ml-1",variant:"white",onClick:L},{default:o(()=>[r($)?(m(),y(b,{key:0,name:"SortAscendingIcon",class:"h-5"})):(m(),y(b,{key:1,name:"SortDescendingIcon",class:"h-5"}))]),_:1})])]),n("div",he,[(m(!0),S(oe,null,ae(r(i).estimates,(s,K)=>(m(),y(M,{id:"estimate-"+s.id,key:K,to:`/${r(f).companySlug}/customer/estimates/${s.id}/view`,class:se(["flex justify-between p-4 items-center cursor-pointer hover:bg-gray-100 border-l-4 border-transparent",{"bg-gray-100 border-l-4 border-primary-500 border-solid":T(s.id)}]),style:{"border-bottom":"1px solid rgba(185, 193, 209, 0.41)"}},{default:o(()=>[n("div",Be,[n("div",ve,p(s.estimate_number),1),a(H,{status:s.status},{default:o(()=>[E(p(s.status),1)]),_:2},1032,["status"])]),n("div",xe,[a(J,{class:"mb-2 text-xl not-italic font-semibold leading-8 text-right text-gray-900 block",amount:s.total,currency:s.currency},null,8,["amount","currency"]),n("div",we,p(s.formatted_estimate_date),1)])]),_:2},1032,["id","to","class"]))),128)),r(i).estimates.length?B("",!0):(m(),S("p",ke,p(e.$t("estimates.no_matching_estimates")),1))])]),n("div",Ee,[r(C)?(m(),S("iframe",{key:0,src:r(C),class:"flex-1 border border-gray-400 border-solid rounded-md"},null,8,Se)):B("",!0)])]),_:1})}}};export{De as default};
